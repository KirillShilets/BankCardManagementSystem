# BankCardManager API

API для управления банковскими картами, пользователями и транзакциями. Позволяет создавать пользователей и карты (администратор), управлять их статусами, а также выполнять операции с картами (переводы, снятие средств, блокировка) для аутентифицированных пользователей.

## Предварительные требования

Для запуска проекта локально вам понадобятся:

*   **Java 17** или выше
*   **Maven 3.6+**
*   **Docker** и **Docker Compose** (для запуска базы данных PostgreSQL)
*   **Git** (для клонирования репозитория)
*   Инструмент для генерации секретных ключей (например, `openssl` или онлайн-генератор)

## Конфигурация

Перед первым запуском необходимо настроить переменные окружения. Создайте файл с именем `.env` в корневом каталоге проекта и добавьте в него следующие переменные:

*   `JWT_SECRET`: Секретный ключ для подписи JWT токенов. **Ключ должен быть закодирован в Base64 и иметь достаточную длину (рекомендуется 256 бит или более).**
    *   Пример генерации 256-битного ключа и кодирования в Base64:
        ```bash
        openssl rand 32 | base64
        ```
*   `JWT_EXPIRATION_MS`: Время жизни JWT токена в миллисекундах.
    *   Пример: `3600000` (1 час)
*   `ENCRYPTION_AES_KEY`: Секретный ключ для шифрования номеров карт (AES/GCM). **Ключ должен быть закодирован в Base64 и иметь длину 128, 192 или 256 бит (16, 24 или 32 байта до кодирования).**
    *   Пример генерации 256-битного ключа (32 байта) и кодирования в Base64:
        ```bash
        openssl rand 32 | base64
        ```

**Пример файла `.env`:**

***Замените значения на ваши сгенерированные ключи!***
JWT_SECRET=ваш_сгенерированный_base64_jwt_секрет_длиной_не_менее_256_бит
JWT_EXPIRATION_MS=3600000
ENCRYPTION_AES_KEY=ваш_сгенерированный_base64_aes_ключ_16_24_или_32_байта

***Важно:*** *Не добавляйте файл `.env` в систему контроля версий (Git)! Добавьте его в `.gitignore`.*

Проект использует `DotenvApplicationContextInitializer` для загрузки этих переменных при старте приложения.

## Запуск приложения

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/KirillShilets/BankCardManagementSystem.git
    cd BankCardManagementSystem
    ```

2.  **Создайте файл `.env`:** Создайте файл `.env` в корне проекта и заполните его значениями, как описано в разделе "Конфигурация".

3.  **Запустите базу данных PostgreSQL с помощью Docker Compose:**
    (Убедитесь, что Docker Desktop запущен)
    ```bash
    docker-compose up -d
    ```
    Эта команда запустит контейнер PostgreSQL в фоновом режиме. База данных будет доступна на порту `5433` хоста (если не изменен `docker-compose.yml`). Убедитесь, что URL в `application.properties` указывает на `jdbc:postgresql://localhost:5433/bank_cards`.
    *   Чтобы проверить логи контейнера: `docker-compose logs -f postgres`
    *   Чтобы остановить и удалить контейнер: `docker-compose down`

4.  **Соберите проект с помощью Maven:**
    ```bash
    mvn clean package
    ```
    Или, если вы хотите установить артефакт в локальный репозиторий:
    ```bash
    mvn clean install
    ```

5.  **Запустите Spring Boot приложение:**
    *   Через Maven:
        ```bash
        mvn spring-boot:run
        ```
    *   Или запустив собранный JAR-файл:
        ```bash
        java -jar target/BankCardManager-0.0.1-SNAPSHOT.jar
        ```

Приложение запустится на порту `8080` по умолчанию.

## Доступ к приложению

*   **API Endpoints:** Доступны по адресу `http://localhost:8080/api/...`
*   **Swagger UI (Документация API):** Откройте в браузере `http://localhost:8080/swagger-ui.html` для просмотра и интерактивного тестирования API.

## База Данных

*   Проект использует **PostgreSQL**. Конфигурация подключения находится в `src/main/resources/application.properties`.
*   Схема базы данных создается и обновляется автоматически при запуске приложения с помощью **Liquibase**. Ченджлоги находятся в `src/main/resources/db/changelog/`.
*   Учетные данные для подключения к БД, используемые в `docker-compose.yml` и `application.properties` (`bankcard_user` / `secretpassword`), предназначены для локальной разработки.

## Технологический стек

*   Java 17
*   Spring Boot 3.x
*   Spring Security (JWT Authentication)
*   Spring Data JPA (Hibernate)
*   PostgreSQL
*   Liquibase
*   Maven
*   Docker / Docker Compose
*   Swagger / OpenAPI 3 (springdoc-openapi)
*   JUnit 5 / Mockito (для тестов)